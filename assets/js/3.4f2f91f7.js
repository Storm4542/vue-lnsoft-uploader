(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{156:function(t,e,i){},158:function(t,e,i){},159:function(t,e,i){},181:function(t,e){!function(t){var e,i='<svg><symbol id="icon-loading2" viewBox="0 0 1024 1024"><path d="M276 473c-93.888 0-170-75.888-170-169.5S182.112 134 276 134s170 75.888 170 169.5S369.888 473 276 473z m549-49c-49.153 0-89-39.623-89-88.5s39.847-88.5 89-88.5 89 39.623 89 88.5-39.847 88.5-89 88.5zM495.5 907C422.875 907 364 848.125 364 775.5S422.875 644 495.5 644 627 702.875 627 775.5 568.125 907 495.5 907z"  ></path></symbol><symbol id="icon-loading" viewBox="0 0 1024 1024"><path d="M755.0464 862.72a34.7648 34.7648 0 0 1-12.8512 48.0256 34.6624 34.6624 0 0 1-47.7696-12.8512 34.7648 34.7648 0 0 1 12.288-48.0256 35.4816 35.4816 0 0 1 48.3328 12.8z m-207.3088 74.9056c0 19.1488-15.8208 35.1744-35.6864 35.1744a35.2768 35.2768 0 0 1-35.1744-35.1744v-24.6272a35.4816 35.4816 0 0 1 70.8608 0v24.6272z m-216.9856-39.7312a35.072 35.072 0 0 1-48.3328 13.0048 34.8672 34.8672 0 0 1-13.0048-48.2816l26.112-45.7728a36.1472 36.1472 0 0 1 48.7936-13.056 35.328 35.328 0 0 1 12.5952 48.3328l-26.1632 45.7728zM162.304 755.712a35.5328 35.5328 0 0 1-48.3328-13.056 35.1744 35.1744 0 0 1 12.5952-48.2816l70.3488-40.7552a35.584 35.584 0 0 1 48.2816 13.0048 35.84 35.84 0 0 1-13.056 48.3328l-69.888 40.7552zM87.3984 547.84a35.1232 35.1232 0 0 1-35.1744-35.1744c0-19.6096 15.5648-35.4304 35.1744-35.4304h109.568c19.5584 0 35.1232 15.872 35.1232 35.1744a35.1744 35.1744 0 0 1-35.1744 35.4304h-109.568z m39.2192-217.3952a34.4576 34.4576 0 0 1-12.5952-48.0256 35.0208 35.0208 0 0 1 48.2816-13.0048l119.0912 69.12a35.2256 35.2256 0 0 1 13.056 47.7696 35.4816 35.4816 0 0 1-48.2304 13.056L126.6688 330.4448z m142.7456-168.3456l82.944 143.9744a35.2256 35.2256 0 1 0 61.0816-35.4304L330.0352 126.976a35.1232 35.1232 0 0 0-60.7232 35.1744z m207.5648-74.3936a35.84 35.84 0 0 1 35.1744-35.4304c19.6096 0 35.6864 15.9232 35.6864 35.4304v165.888a35.84 35.84 0 0 1-35.6864 35.6864 35.328 35.328 0 0 1-35.1744-35.7376V87.7056z m217.0368 39.2192a35.4304 35.4304 0 0 1 48.2816-13.056 34.816 34.816 0 0 1 13.056 48.3328L672.2048 306.176a35.4304 35.4304 0 0 1-48.2816 13.056 35.9424 35.9424 0 0 1-12.8512-48.5888l82.944-143.7184z m168.8576 142.4896l-144.128 83.0976a35.4816 35.4816 0 0 0-13.056 48.2816 36.2496 36.2496 0 0 0 48.2816 12.8512l144.2816-83.0976a34.9184 34.9184 0 0 0 12.5952-48.0256 34.6624 34.6624 0 0 0-47.9744-13.1072z m74.1376 207.872c19.7632 0 35.4304 15.7696 35.1744 35.3792a34.9184 34.9184 0 0 1-35.1744 35.1744h-166.0416a35.5328 35.5328 0 0 1-35.2256-35.4304c0-19.3536 16.0768-35.1744 35.2256-35.1744h166.0416z"  ></path></symbol><symbol id="icon-delete" viewBox="0 0 1024 1024"><path d="M139.43164062 512C139.43164062 305.94042969 306.3359375 139.03613281 512 139.03613281s372.56835938 166.90429688 372.56835938 372.56835938V512A372.17285156 372.17285156 0 0 1 512 884.56835938C305.94042969 884.56835938 139.43164062 717.6640625 139.43164062 512z m397.48535157 0l130.12207031-130.12207031a16.93492536 16.93492536 0 0 0 0-24.12597657l-0.79101562-0.79101562a16.93492536 16.93492536 0 0 0-24.12597657 0L512 487.47851562l-130.12207031-130.51757812a16.93492536 16.93492536 0 0 0-24.12597657 0l-0.79101562 0.79101563a16.93492536 16.93492536 0 0 0 0 24.12597656l130.12207031 130.51757812-130.12207031 130.12207032a16.93492536 16.93492536 0 0 0 0 24.12597656l0.79101563 0.79101562a16.93492536 16.93492536 0 0 0 24.12597656 0L512 537.3125l130.12207031 130.12207031a16.93492536 16.93492536 0 0 0 24.12597657 0l0.79101562-0.79101562a16.93492536 16.93492536 0 0 0 0-24.12597656L536.91699219 512z"  ></path></symbol></svg>';if((e=document.getElementsByTagName("script"))[e.length-1].getAttribute("data-injectcss")&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(e){console&&console.log(e)}}!function(e){if(document.addEventListener)if(~["complete","loaded","interactive"].indexOf(document.readyState))setTimeout(e,0);else{document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t,!1),e()},!1)}else document.attachEvent&&(i=e,n=t.document,s=!1,o=function(){s||(s=!0,i())},(a=function(){try{n.documentElement.doScroll("left")}catch(t){return void setTimeout(a,50)}o()})(),n.onreadystatechange=function(){"complete"==n.readyState&&(n.onreadystatechange=null,o())});var i,n,s,o,a}(function(){var t,e;(t=document.createElement("div")).innerHTML=i,i=null,(e=t.getElementsByTagName("svg")[0])&&(e.setAttribute("aria-hidden","true"),e.style.position="absolute",e.style.width=0,e.style.height=0,e.style.overflow="hidden",function(t,e){e.firstChild?function(t,e){e.parentNode.insertBefore(t,e)}(t,e.firstChild):e.appendChild(t)}(e,document.body))})}(window)},182:function(t,e,i){"use strict";var n=i(156);i.n(n).a},206:function(t,e,i){"use strict";var n=i(158);i.n(n).a},207:function(t,e,i){"use strict";var n=i(159);i.n(n).a},209:function(t,e,i){"use strict";i.r(e);i(168),i(94);var n=i(8),s=(i(53),i(176),i(178),i(181),{name:"g-icon",props:["iconname"]}),o=(i(182),i(0)),a=Object(o.a)(s,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("svg",{staticClass:"g-icon",on:{click:function(e){return t.$emit("click",e)}}},[i("use",{attrs:{"xlink:href":"#icon-"+t.iconname}})])},[],!1,null,"290501f0",null).exports,c=(i(14),i(183),i(184)),l=i(185).default,r=function(t){if(this.renderTo=document.body,this.canvas=document.createElement("canvas"),this.output=t.output,this.width=t.width,this.height=t.height,this.canvas.width=t.width*this.output,this.canvas.height=t.height*this.output,this.circle=t.circle,t.width!==t.height&&t.circle)throw"can't set circle to true when width is not equal to height";this.ctx=this.canvas.getContext("2d"),this.croppingBox=document.createElement("div"),this.croppingBox.style.visibility="hidden",this.croppingBox.className=t.className||"",this.cover=document.createElement("canvas"),this.type=t.type||"png",this.cover.width=window.innerWidth,this.cover.height=window.innerHeight,this.cover_ctx=this.cover.getContext("2d"),this.img=document.createElement("img"),"http"===t.image_src.substring(0,4).toLowerCase()&&(this.img.crossOrigin="anonymous"),this.cancel=t.cancel,this.ok=t.ok,this.ok_text=t.ok_text||"ok",this.cancel_text=t.cancel_text||"cancel",this.croppingBox.appendChild(this.img),this.croppingBox.appendChild(this.cover),this.renderTo.appendChild(this.croppingBox),this.img.onload=this.init.bind(this),this.img.src=t.image_src,this.cancel_btn=document.createElement("a"),this.cancel_btn.innerHTML=this.cancel_text,this.ok_btn=document.createElement("a"),this.ok_btn.innerHTML=this.ok_text,this.croppingBox.appendChild(this.ok_btn),this.croppingBox.appendChild(this.cancel_btn),this.alloyFingerList=[]};r.prototype={init:function(){this.img_width=this.img.naturalWidth,this.img_height=this.img.naturalHeight,l(this.img,!0);var t=window.innerWidth/this.img_width;window.innerHeight,this.img_height;this.initScale=t,this.originScale=t,this.img.scaleX=this.img.scaleY=t,this.first=1;var e=this;this.alloyFingerList.push(new c(this.croppingBox,{multipointStart:function(t){var i=(t.touches[0].pageX+t.touches[1].pageX)/2,n=(t.touches[0].pageY+t.touches[1].pageY)/2,s=e.img.getBoundingClientRect(),o=i-(s.left+s.width/2),a=n-(s.top+s.height/2),c=e.img.originX,l=e.img.originY;e.img.originX=o/e.img.scaleX,e.img.originY=a/e.img.scaleY,e.img.translateX+=o-c*e.img.scaleX,e.img.translateY+=a-l*e.img.scaleX,1==e.first&&(e.img.scaleX=e.img.scaleY=1.1*e.initScale,++e.first),e.initScale=e.img.scaleX},pinch:function(t){var i=e.img.getBoundingClientRect(),n=(document.documentElement.clientHeight-e.height)/2,s=t.zoom,o=(i.width*s-i.width)/2,a=(i.height-i.height*s)/2;e.initScale*s<=1.6&&e.initScale*s>=e.originScale&&o>=i.left&&-o<=i.right-e.width&&a<=n-i.top&&a<=i.bottom-n-e.height&&(e.img.scaleX=e.img.scaleY=e.initScale*s)},pressMove:function(t){var i=e.img.getBoundingClientRect(),n=(document.documentElement.clientHeight-e.height)/2;n-i.top-t.deltaY>=0&&i.bottom+t.deltaY-n>=e.height&&(e.img.translateY+=t.deltaY);var s=(document.documentElement.clientWidth-e.width)/2;i.left+t.deltaX<=s&&i.right+t.deltaX-s>=e.width&&(e.img.translateX+=t.deltaX),t.preventDefault()}})),this.alloyFingerList.push(new c(this.cancel_btn,{touchStart:function(){e.cancel_btn.style.backgroundColor="#ffffff",e.cancel_btn.style.color="#3B4152"},tap:this._cancel.bind(this)})),this.alloyFingerList.push(new c(this.ok_btn,{touchStart:function(){e.ok_btn.style.backgroundColor="#2bcafd",e.ok_btn.style.color="#ffffff"},tap:this._ok.bind(this)})),this.alloyFingerList.push(new c(document,{touchEnd:function(){e.cancel_btn.style.backgroundColor="#ffffff",e.ok_btn.style.backgroundColor="#2bcafd"}})),this.renderCover(),this.setStyle()},_cancel:function(){this._css(this.croppingBox,{display:"none"}),this.cancel()},_ok:function(){this.crop(),this._css(this.croppingBox,{display:"none"}),this.ok(this.canvas.toDataURL("image/"+this.type),this.canvas)},renderCover:function(){var t=this.cover_ctx,e=this.cover.width,i=this.cover.height,n=this.width,s=this.height;t.save(),t.fillStyle="black",t.globalAlpha=.7,t.fillRect(0,0,this.cover.width,this.cover.height),t.restore(),t.save(),t.globalCompositeOperation="destination-out",t.beginPath(),this.circle?t.arc(e/2,i/2,n/2-4,0,2*Math.PI,!1):t.rect(e/2-n/2,i/2-s/2,n,s),t.fill(),t.restore(),t.save(),t.beginPath(),t.strokeStyle="white",this.circle?t.arc(e/2,i/2,n/2-4,0,2*Math.PI,!1):t.rect(e/2-n/2,i/2-s/2,n,s),t.stroke()},setStyle:function(){this._css(this.cover,{position:"fixed",zIndex:"100",left:"0px",top:"0px"}),this._css(this.croppingBox,{color:"white",textAlign:"center",fontSize:"18px",textDecoration:"none",visibility:"visible"}),this._css(this.img,{position:"fixed",zIndex:"99",left:"50%",top:window.innerHeight/2+"px",marginLeft:this.img_width/-2+"px",marginTop:this.img_height/-2+"px"}),this._css(this.ok_btn,{position:"fixed",zIndex:"101",width:"100px",right:"50px",lineHeight:"40px",height:"40px",bottom:"20px",borderRadius:"2px",color:"#ffffff",backgroundColor:"#2bcafd"}),this._css(this.cancel_btn,{position:"fixed",zIndex:"101",width:"100px",height:"40px",lineHeight:"40px",left:"50px",bottom:"20px",borderRadius:"2px",color:"#3B4152",backgroundColor:"#ffffff"})},crop:function(){this.calculateRect(),this.ctx.drawImage(this.img,this.crop_rect[0],this.crop_rect[1],this.crop_rect[2],this.crop_rect[3],0,0,this.crop_rect[2]*this.img.scaleX,this.crop_rect[3]*this.img.scaleY)},calculateRect:function(){var t=this.img.getBoundingClientRect(),e=window.innerWidth/2-this.width/2,i=window.innerHeight/2-this.height/2,n=[e,i,this.width+e,this.height+i],s=[t.left,t.top,t.width+t.left,t.height+t.top],o=this.getOverlap.apply(this,n.concat(s)),a=(o[0]-s[0])/this.img.scaleX,c=(o[1]-s[1])/this.img.scaleY,l=o[2]/this.img.scaleX,r=o[3]/this.img.scaleY;a<0&&(a=0),c<0&&(c=0),a+l>this.img_width&&(l=this.img_width-a),c+r>this.img_height&&(r=this.img_height-c),this.crop_rect=[a,c,l,r]},getOverlap:function(t,e,i,n,s,o,a,c){if(i<s||n<o||t>a||e>c)return[0,0,0,0];var l=Math.max(t,s),r=Math.max(e,o);return[l,r,Math.min(i,a)-l,Math.min(n,c)-r]},_css:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t.style[i]=e[i])},destroy:function(){for(var t in this.alloyFingerList.forEach(function(t){t.destroy()}),this.renderTo.removeChild(this.croppingBox),this)delete this[t]}};var h=r,d=i(186),u=i.n(d),p=i(187),f=i.n(p),g={name:"uploader",components:{GIcon:a},props:{imageCut:{type:Boolean,default:!0},blob:{type:Boolean,default:!1},action:{type:String,required:!0},name:{type:String,required:!0},method:{type:String,default:"POST"},parseResponse:{type:Function,required:!0},fileList:{type:Array,default:function(){return[]}},height:{type:[Number,String],default:80},width:{type:[Number,String],default:80}},methods:{onClickUpload:function(){var t=this,e=this.createInput();e.addEventListener("change",function(){t.imageCut?t.choosePhoto(e.files[0]):t.uploadFiles(void 0,e.files),e.remove()}),e.click()},createInput:function(){this.$refs.temp.innerHTML="";var t=document.createElement("input");return t.type="file",t.multiple=!this.imageCut,this.$refs.temp.appendChild(t),t},beforeUploadFile:function(t,e){var i=t.size,n=t.type;return this.$emit("addFile",{name:e,size:i,type:n,status:"uploading"}),!0},choosePhoto:function(t){var e=this,i=new FileReader;"undefined"==typeof FileReader?alert("浏览器不支持图片预览功能，请换浏览器重试"):(i.readAsDataURL(t),i.onload=function(){e.clipImg(i.result,t)})},clipImg:function(t,e){var i=this;new h({image_src:t,circle:!1,width:300,height:300,output:1,ok:function(t,n){console.log("ok"),i.uploadFiles(t,e)},cancel:function(){},ok_text:"确定",cancel_text:"取消"})},uploadFiles:function(t,e){var i=this;if(this.imageCut){var n=e.name,s=this.generateName(n);if(this.beforeUploadFile(e,s),this.blob){var o=new FormData;o.append(this.name,this.convertBase64ToBlob(t),s),this.ajax(o,s,!0)}else{var a={filename:s,file:t,time:new Date};this.ajax(a,s,!1)}}else Array.from(e).map(function(t){var n=t.name,s=i.generateName(n);i.beforeUploadFile(e,s),u()(t,{width:800,quality:.5}).then(function(t){if(i.blob){var e=new FormData;e.append(i.name,t.file,s),console.log("lrz formdata",e.getAll(i.name)),i.ajax(e,s,!0)}else{var n={filename:s,file:t.base64,time:new Date};i.ajax(n,s,!1)}})})},afterUploadFiles:function(t,e){console.log(this.fileList);var i=this.fileList.filter(function(t){return t.name===e})[0],s=this.fileList.indexOf(i),o=JSON.parse(JSON.stringify(i));o.url=t,o.status="success";var a=Object(n.a)(this.fileList);a.splice(s,1,o),this.$emit("update:fileList",a)},convertBase64ToBlob:function(t){var e=t.split(","),i="",n="";e.length>1&&(n=e[1],i=e[0].substring(e[0].indexOf(":")+1,e[0].indexOf(";")));for(var s=atob(n),o=new ArrayBuffer(s.length),a=new Uint8Array(o),c=0;c<s.length;c++)a[c]=s.charCodeAt(c);return new Blob([o],{type:i})},generateName:function(t){for(;this.fileList.filter(function(e){return e.name===t}).length>0;){var e=t.lastIndexOf("."),i=t.substring(0,e),n=t.substring(e);t=i+"(1)"+n}return t},ajax:function(t,e,i){var n=this;i?f.a.request({url:this.action,method:"post",headers:{"Content-Type":"multipart/form-data"},data:t}).then(function(t){console.log(t);var i=n.parseResponse(t);n.afterUploadFiles(i,e)}).catch(function(){n.uploadError(e)}):f.a.request({url:this.action,method:"post",data:t}).then(function(t){console.log(t);var i=n.parseResponse(t);n.afterUploadFiles(i,e)}).catch(function(){n.uploadError(e)})},uploadError:function(t){var e=this.fileList.filter(function(e){return e.name===t})[0],i=JSON.parse(JSON.stringify(e));i.status="fail";var s=Object(n.a)(this.fileList),o=s.indexOf(e);s.splice(o,1,i),this.$emit("update:fileList",s)},onRemoveFile:function(t){var e=JSON.parse(JSON.stringify(this.fileList));e.filter(function(i,n){i.name===t.name&&e.splice(n,1)}),this.$emit("update:fileList",e)}}},m=(i(206),{name:"app",components:{GUploader:Object(o.a)(g,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"uploader"},[i("ol",{staticClass:"fileList"},[t._l(t.fileList,function(e){return i("li",{key:e.name},[i("div",{staticClass:"image-wrapper"},["uploading"===e.status?[i("g-icon",{staticClass:"spin icon-loading",attrs:{iconname:"loading2"}})]:e.url.indexOf("http")>=0?[i("img",{staticClass:"addFile",style:{width:t.width+"px",height:t.height+"px"},attrs:{src:e.url,alt:""}}),t._v(" "),i("div",{staticClass:"remove-wrapper"},[i("g-icon",{staticClass:"remove-icon",attrs:{iconname:"delete"},on:{click:function(i){return t.onRemoveFile(e)}}})],1)]:[i("div",{staticClass:"defaultImage"}),t._v(" "),i("div",{staticClass:"remove-wrapper"},[i("g-icon",{staticClass:"remove-icon",attrs:{iconname:"delete"},on:{click:function(i){return t.onRemoveFile(e)}}})],1)]],2)])}),t._v(" "),i("li",[i("div",{on:{click:t.onClickUpload}},[i("div",{staticClass:"addFile",style:{width:t.width+"px",height:t.height+"px"}},[i("div",{staticClass:"row"}),t._v(" "),i("div",{staticClass:"col"})])])])],2),t._v(" "),i("img",{attrs:{src:t.blob,alt:""}}),t._v(" "),i("div",{ref:"temp",staticStyle:{width:"0",height:"0",overflow:"hidden"}})])},[],!1,null,"c4c5ecc0",null).exports},data:function(){return{fileList:[],fileList2:[],URL:"https://image-server-gulu.herokuapp.com/upload"}},methods:{parseResponse:function(t){return t},addFile:function(t){this.fileList.push(t)},addFile2:function(t){this.fileList2.push(t)}}}),v=(i(207),Object(o.a)(m,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{"margin-top":"20px"}},[i("h4",[t._v(" 不可裁剪模式（可多文件上传）")]),t._v(" "),i("g-uploader",{attrs:{height:"80",width:"80",action:t.URL,imageCut:!1,name:"file",method:"POST",parseResponse:t.parseResponse,"file-list":t.fileList},on:{addFile:t.addFile,"update:fileList":function(e){t.fileList=e},"update:file-list":function(e){t.fileList=e}}}),t._v(" "),i("h4",[t._v(" 可裁剪模式(请在移动端尝试，否则会有bug)")]),t._v(" "),i("g-uploader",{attrs:{height:"80",width:"80",action:t.URL,imageCut:!0,name:"file",method:"POST",parseResponse:t.parseResponse,"file-list":t.fileList2},on:{addFile:t.addFile2,"update:fileList":function(e){t.fileList2=e},"update:file-list":function(e){t.fileList2=e}}})],1)},[],!1,null,null,null));e.default=v.exports}}]);